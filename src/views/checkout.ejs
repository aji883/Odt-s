<%- include('partials/header', { title: title, bodyClass: bodyClass }) %>

<a href="javascript:history.back()" class="btn-back">‚Üê </a>

<div class="form-container">
    <h2>Konfirmasi Pembelian</h2>
    <p>Anda akan membeli item berikut. Harap isi detail pengiriman.</p>

    <div class="item-card" style="margin: 0 auto 2rem auto; max-width: 300px;">
        <img src="/<%= item.image_url %>" alt="<%= item.title %>" class="item-image">
        <h3><%= item.title %></h3>
        <p class="price" style="font-size: 1.3em; font-weight: bold; color: #fff;">
            Harga: Rp <%= item.price.toLocaleString('id-ID') %>
        </p>
    </div>
    
    <form action="/transactions/buy/<%= item.id %>" method="POST" enctype="multipart/form-data">
        
        <div class="form-group">
            <label for="shipping_address">Alamat Pengiriman Lengkap</label>
            <textarea id="shipping_address" name="shipping_address" rows="4" placeholder="Masukkan nama, no. telp, dan alamat lengkap Anda..." required></textarea>
        </div>
        
        <div class="form-group">
            <label for="payment_method">Metode Pembayaran</label>
            <select id="payment_method" name="payment_method" class="form-control" required onchange="toggleProofInput()">
                <option value="">-- Pilih Pembayaran --</option>
                <option value="COD (Bayar di Tempat)">COD (Bayar di Tempat)</option>
                <option value="Transfer Bank">Transfer Bank</option>
            </select>
        </div>

        <div class="form-group" id="proof-container" style="display: none;">
            <label for="paymentProof">Upload Bukti Transfer</label>
            <input type="file" id="paymentProof" name="paymentProof">
            <small>Format: JPG, PNG. Wajib diisi untuk Transfer Bank.</small>
        </div>

        <button type="submit" class="btn btn-primary">Konfirmasi & Beli</button>
    </form>
</div>

<%- include('partials/footer') %>

<script>
    function toggleProofInput() {
        const paymentSelect = document.getElementById('payment_method');
        const proofContainer = document.getElementById('proof-container');
        const proofInput = document.getElementById('paymentProof');

        if (paymentSelect.value === 'Transfer Bank') {
            proofContainer.style.display = 'block'; // Tampilkan
            proofInput.required = true; // Wajib diisi
        } else {
            proofContainer.style.display = 'none'; // Sembunyikan
            proofInput.required = false; // Tidak wajib
            proofInput.value = ''; // Reset file jika batal transfer
        }
    }
</script>