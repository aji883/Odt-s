<%- include('partials/header', { title: title, bodyClass: bodyClass }) %>

<div class="profile-container">

    <aside class="profile-sidebar">
        <% if (user) { %> 
            <div class="user-info">
                <img src="/<%= user.profilePicture || 'uploads/default-avatar.png' %>" alt="<%= user.username %>" class="user-avatar">
                <h2 class="user-name"><%= user.username %></h2>
                <p class="user-email"><%= user.email %></p> 
                <p class="user-phone"><%= user.phoneNumber || 'No. Telepon belum diatur' %></p>
            </div>
            <nav class="profile-nav">
                <a href="/items/new" class="nav-button"><span>â•</span> Tambah Item Baru</a>
                <a href="/user/profile" class="nav-button"><span>ğŸ‘•</span> Koleksi Saya</a>
                <a href="/user/favorites" class="nav-button"><span>â­</span> Item Favorit</a>
                <a href="/transactions/received" class="nav-button active"><span>ğŸ””</span> Notifikasi</a>
                <a href="/user/profile/edit" class="nav-button"><span>âœï¸</span> Edit Profil</a>
                <a href="/auth/logout" class="nav-button"><span>ğŸšª</span> Logout</a>
            </nav>
        <% } %>
    </aside>
    <div class="profile-main">
        <div class="main-header-block">
            <h1>Tawaran yang Anda Terima</h1>
            <p>Tawaran dari pengguna lain untuk item Anda. Klik untuk merespon.</p>
        </div>

        <div class="offer-section">
            <div class="offer-list">
                <% if(offers && offers.length > 0) { %>
                    <% offers.forEach(offer => { %>
                        
                        <div class="offer-card status-<%= offer.status %>">
                            <a href="/transactions/<%= offer.id %>" class="offer-card-main-link">
                                <img src="/<%= offer.image_url %>" alt="<%= offer.item_title %>" class="offer-image">
                                <div class="offer-info">
                                    <h4><%= offer.item_title %></h4>
                                    <p>Tawaran <strong><%= offer.type %></strong> dari <strong><%= offer.proposer_username %></strong></p>
                                </div>
                            </a>
                            
                            <div class="offer-actions">
                                <span class="offer-status"><%= offer.status %></span>
                                
                                <% if (offer.status !== 'pending') { %>
                                    <form action="/transactions/<%= offer.id %>/hide-received" method="POST" onsubmit="return confirm('Yakin ingin menghapus riwayat tawaran ini?');">
                                        <button type="submit" class="btn-delete-history">Hapus</button>
                                    </form>
                                <% } else { %>
                                    <span class="btn-pending">Perlu Respon</span>
                                <% } %>
                            </div>
                        </div>

                    <% }) %>
                <% } else { %>
                    <p>Belum ada tawaran yang Anda terima.</p>
                <% } %>
            </div>
        </div>
    </div>
</div>
<%- include('partials/footer') %>

<style>
    .btn-pending {
        background-color: transparent;
        color: #f39c12; /* Warna kuning 'pending' */
        font-size: 0.8em;
        font-weight: bold;
        padding: 6px 10px;
        border-radius: 5px;
        border: 1px solid #f39c12;
    }
</style>