<%- include('partials/header', { title: title, bodyClass: typeof bodyClass != 'undefined' ? bodyClass : '' }) %>

<a href="javascript:history.back()" class="btn-back">← Kembali</a>

<div class="item-detail-container">
    <div class="item-detail-image">
        <img src="/<%= item.image_url %>" alt="<%= item.title %>">
    </div>
    <div class="item-detail-info">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem;">
            <h1><%= item.title %></h1>

            <div class="favorite-section">
                <% if (!isOwner && user) { // Tampilkan jika bukan pemilik & user login %>
                    <form action="/items/<%= item.id %>/favorite" method="POST" class="favorite-form">
                        <button type="submit" class="btn-favorite <%= typeof isFavorited != 'undefined' && isFavorited ? 'favorited' : '' %>">⭐</button>
                    </form>
                <% } %>
                <span class="favorite-count">
                    <%= item.favorite_count %> disukai
                </span>
            </div>
            </div>
        <p class="item-owner">Oleh: <a href="/user/<%= item.user_id %>"><%= item.owner_username %></a></p>

        <div class="item-meta">
            <span><strong>Kategori:</strong> <%= item.category %></span> |
            <span><strong>Ukuran:</strong> <%= item.size %></span> |
            <span><strong>Status:</strong> <%= item.status %></span>
            <% if(item.status === 'Dijual' && item.price) { %>
                | <span><strong>Harga:</strong> Rp <%= item.price.toLocaleString('id-ID') %></span>
            <% } %>
        </div>

        <div class="item-description">
            <h3>Deskripsi</h3>
            <p><%- item.description %></p>
        </div>

        <div class="item-actions">
             <% if (isOwner) { %>
                <a href="/items/<%= item.id %>/edit" class="btn btn-secondary">Edit Item</a>
                <form action="/items/<%= item.id %>/delete" method="POST" style="display:inline;" onsubmit="return confirm('Yakin ingin menghapus item ini?');">
                    <button type="submit" class="btn btn-danger">Hapus Item</button>
                </form>
            <% } else { %>
                <% if (item.status === 'Dijual') { %>
                    <a href="/transactions/buy/<%= item.id %>" class="btn btn-primary">Beli Sekarang</a>
                 <% } else if (item.status === 'Bisa di-Swap') { %>
                    <a href="/transactions/start-swap/<%= item.id %>" class="btn btn-primary">Tawarkan Barter</a>
                 <% } else { %>
                    <p><em>Item ini hanya untuk dipamerkan.</em></p>
                 <% } %>
            <% } %>
        </div>
    </div>
</div>

<%- include('partials/footer') %>